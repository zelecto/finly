{% extends "base.html" %}

{% block title %}Inter√©s Simple{% endblock %}

{% block content %}
<!-- Contenido principal -->
<div class="container">
    <!-- Header -->
    <div class="header-small">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="FINLY Logo" class="logo-small">
        <h1>üìà Inter√©s Simple</h1>
        <span class="user-info">{{ username }}</span>
    </div>

<div class="teoria-section">
        <button class="teoria-toggle" type="button" id="teoriaBtn">
            <span id="teoriaIcon">‚ñ∂</span> Teor√≠a: ¬øQu√© es el Inter√©s Simple?
        </button>
        <div class="teoria-content" id="teoriaContent">
            <h3>üí° Conceptos B√°sicos</h3>
            <p><strong>El inter√©s simple</strong> es el inter√©s que se calcula sobre el capital inicial durante todo el per√≠odo de la inversi√≥n.</p>
            
            <h4>F√≥rmula Principal:</h4>
            <div class="formula-box">
                <strong>M = P + I</strong><br>
                <strong>I = P √ó i √ó t</strong><br>
                Donde: <strong>M = P(1 + i √ó t)</strong>
            </div>

            <h4>Variables:</h4>
            <ul>
                <li><strong>P (Capital):</strong> Dinero inicial invertido</li>
                <li><strong>i (Tasa):</strong> Porcentaje de inter√©s anual (en decimal)</li>
                <li><strong>t (Tiempo):</strong> Per√≠odo en a√±os</li>
                <li><strong>M (Monto):</strong> Capital final = Capital + Inter√©s</li>
                <li><strong>I (Inter√©s):</strong> Ganancia generada</li>
            </ul>
        </div>
    </div>

    <p class="instruction">Completa <strong>3 campos</strong> y deja <strong>1 vac√≠o</strong>. FINLY calcular√° autom√°ticamente el campo faltante.</p>

    <form class="form" id="simpleForm">
        <div class="input-row">
            <div class="input-group">
                <label>Capital Inicial (P):</label>
                <input type="number" id="capital" step="0.01" placeholder="Ej. 1000">
                <small>Dinero inicial a invertir</small>
            </div>

            <div class="input-group">
                <label>Tasa de Inter√©s (% anual):</label>
                <input type="number" id="tasa" step="0.01" placeholder="Ej. 5">
                <small>Porcentaje de ganancia anual</small>
            </div>
        </div>

        <div class="input-row">
            <div class="input-group">
                <label>Tiempo:</label>
                <div class="time-inputs">
                    <input type="number" id="tiempo_dias" step="1" placeholder="D√≠as">
                    <input type="number" id="tiempo_meses" step="1" placeholder="Meses">
                    <input type="number" id="tiempo_anios" step="1" placeholder="A√±os">
                </div>
                <small>Duraci√≥n de la inversi√≥n</small>
            </div>

            <div class="input-group">
                <label>Monto Final (M):</label>
                <input type="number" id="monto" step="0.01" placeholder="Ej. 1100">
                <small>Dinero total al final</small>
            </div>
        </div>

        <button type="submit" class="btn" id="calcularBtn">üßÆ Calcular Autom√°ticamente</button>
    </form>

    <div class="result-box hidden" id="resultBox">
    <div class="result-content">
        <h3>üí∞ Resultado:</h3>
        <div class="result-detail" id="resultValue"></div> 
        <div class="result-detail" id="resultDetail"></div>
        <div class="result-detail" id="interestDetail"></div>
    </div>
</div>


    <a href="/" class="btn-back">‚¨Ö Volver al Men√∫</a>
</div>
<script>
    // Funci√≥n para toggle de teor√≠a
    document.getElementById('teoriaBtn').addEventListener('click', function() {
        const content = document.getElementById('teoriaContent');
        const icon = document.getElementById('teoriaIcon');
        
        content.classList.toggle('show');
        icon.classList.toggle('rotated');
    });

    const form = document.getElementById('simpleForm');
    const capitalInput = document.getElementById('capital');
    const tasaInput = document.getElementById('tasa');
    const tiempoDiasInput = document.getElementById('tiempo_dias');
    const tiempoMesesInput = document.getElementById('tiempo_meses');
    const tiempoAniosInput = document.getElementById('tiempo_anios');
    const montoInput = document.getElementById('monto');
    const resultBox = document.getElementById('resultBox');
    const resultValue = document.getElementById('resultValue');
    const resultDetail = document.getElementById('resultDetail');
    const interestDetail = document.getElementById('interestDetail');

    // ‚ö°Ô∏è Pega aqu√≠ tu URL p√∫blica de ngrok
    const API_URL = "http://127.0.0.1:5000/calcular_Interes_Simple";

    form.addEventListener('submit', async function (e) {
        e.preventDefault();

        const tiempoLleno = tiempoDiasInput.value || tiempoMesesInput.value || tiempoAniosInput.value;

        let filled = 0;
        if (capitalInput.value) filled++;
        if (tasaInput.value) filled++;
        if (tiempoLleno) filled++;
        if (montoInput.value) filled++;

        if (filled !== 3) {
            resultBox.classList.remove('hidden');
            resultValue.innerText = "‚ö† Validaci√≥n incorrecta";
            resultDetail.innerText = "Debes completar exactamente 3 campos y dejar 1 vac√≠o.";
            interestDetail.innerText = "";
            return;
        }

        // Crear objeto con los datos
        const payload = {
            Vi: capitalInput.value ? parseFloat(capitalInput.value) : null,
            i: tasaInput.value ? parseFloat(tasaInput.value) : null,
            t_d: tiempoDiasInput.value ? parseInt(tiempoDiasInput.value) : null,
            t_m: tiempoMesesInput.value ? parseInt(tiempoMesesInput.value) : null,
            t_a: tiempoAniosInput.value ? parseInt(tiempoAniosInput.value) : null,
            Vf: montoInput.value ? parseFloat(montoInput.value) : null
        };

        try {
            const response = await fetch(API_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });

            const data = await response.json();

            resultBox.classList.remove('hidden');
            if (response.ok) {
                // Si esperas Vf
                if (data.Vf !== undefined) {
                    resultDetail.innerText = ` Monto final: ${data.Vf[0]}
                    Interes: ${data.Vf[1]}`;
                }
                // Si esperas Vi
                else if (data.Vi !== undefined) {
                    resultDetail.innerText = `${data.Vi}`;
                }
                // Si esperas tiempo
                else if (data.t !== undefined) {
                    const porcentaje =(data.t*100)
                    resultDetail.innerText = `${porcentaje.toFixed(3)}`;
                }
                else {
                    resultDetail.innerText = "No se pudo calcular.";
                }

                interestDetail.innerText = "C√°lculo realizado correctamente.";
            } else {
                resultValue.innerText = "‚ö† Error en el c√°lculo";
                resultDetail.innerText = data.detail || "Ocurri√≥ un error inesperado.";
                interestDetail.innerText = "";
            }
        } catch (error) {
            resultBox.classList.remove('hidden');
            resultValue.innerText = "‚ö† Error de conexi√≥n";
            resultDetail.innerText = "No se pudo conectar con la API.";
            interestDetail.innerText = error.toString();
        }
    });
</script>

{% endblock %}
